
<!doctype html>
<html><head><meta charset="utf-8"><title>Fantasy Helper Admin</title>
<style>
  body { font-family: Arial, sans-serif; margin: 40px; background: #f5f5f5; }
  .container { max-width: 1200px; margin: 0 auto; }
  .card { background: white; padding: 20px; margin: 20px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
  .form-group { margin: 15px 0; }
  label { display: block; margin-bottom: 5px; font-weight: bold; }
  input, select, textarea { padding: 8px; width: 100%; max-width: 400px; border: 1px solid #ccc; border-radius: 4px; }
  button { padding: 10px 20px; background: #007cba; color: white; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
  button:hover { background: #005a87; }
  button.secondary { background: #6c757d; }
  button.secondary:hover { background: #545b62; }
  button.danger { background: #dc3545; }
  button.danger:hover { background: #c82333; }
  .result { margin: 20px 0; padding: 15px; border-radius: 4px; }
  .error { background: #ffe6e6; color: #d00; border: 1px solid #f5c6cb; }
  .success { background: #e6ffe6; color: #060; border: 1px solid #c3e6cb; }
  .info { background: #f0f8ff; color: #004085; border: 1px solid #b8daff; }
  .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
  .table { width: 100%; border-collapse: collapse; margin: 10px 0; }
  .table th, .table td { padding: 8px; text-align: left; border-bottom: 1px solid #ddd; }
  .table th { background: #f8f9fa; font-weight: bold; }
  .tabs { display: flex; border-bottom: 1px solid #ddd; margin-bottom: 20px; }
  .tab { padding: 10px 20px; cursor: pointer; border-bottom: 2px solid transparent; }
  .tab.active { border-bottom-color: #007cba; font-weight: bold; }
  .tab-content { display: none; }
  .tab-content.active { display: block; }
  .status { padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; }
  .status.connected { background: #d4edda; color: #155724; }
  .status.disconnected { background: #f8d7da; color: #721c24; }
  .auth-section { background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; border-radius: 4px; margin: 20px 0; }
</style>
</head>
<body>
  <div class="container">
    <h1>üèí Fantasy Helper Admin</h1>
    <p>Manage leagues, managers, and test the system.</p>
    
    <!-- Authentication Status -->
    <div class="auth-section">
      <h3>üîê Authentication Status</h3>
      <p>Yahoo: <span id="yahooStatus" class="status disconnected">Not Connected</span> 
         <button onclick="authYahoo()" class="secondary">Connect Yahoo</button></p>
      <p>Google: <span id="googleStatus" class="status disconnected">Not Connected</span> 
         <button onclick="authGoogle()" class="secondary">Connect Google</button></p>
    </div>
    
    <!-- Navigation Tabs -->
    <div class="tabs">
      <div class="tab active" onclick="showTab('leagues')">Leagues</div>
      <div class="tab" onclick="showTab('managers')">Managers</div>
      <div class="tab" onclick="showTab('config')">Configuration</div>
      <div class="tab" onclick="showTab('reports')">Generate Reports</div>
      <div class="tab" onclick="showTab('test')">Test Run</div>
      <div class="tab" onclick="showTab('logs')">Logs</div>
    </div>
    
    <!-- Leagues Tab -->
    <div id="leagues" class="tab-content active">
      <div class="card">
        <h2>üìä Manage Leagues</h2>
        
        <h3>Add New League</h3>
        <form id="leagueForm">
          <div class="form-group">
            <label for="leagueId">League ID:</label>
            <input type="text" id="leagueId" name="leagueId" required placeholder="e.g., 123456">
          </div>
          <div class="form-group">
            <label for="leagueName">League Name (optional):</label>
            <input type="text" id="leagueName" name="leagueName" placeholder="My Fantasy League">
          </div>
          <div class="form-group">
            <label for="sport">Sport:</label>
            <select id="sport" name="sport">
              <option value="nhl">NHL</option>
              <option value="nfl">NFL</option>
            </select>
          </div>
          <div class="form-group">
            <label for="provider">Provider:</label>
            <select id="provider" name="provider">
              <option value="yahoo">Yahoo</option>
              <option value="espn">ESPN</option>
            </select>
          </div>
          <button type="submit">Add League</button>
        </form>
        
        <h3>Sync League Data</h3>
        <form id="syncForm">
          <div class="form-group">
            <label for="syncLeagueId">League ID:</label>
            <input type="text" id="syncLeagueId" name="leagueId" required>
          </div>
          <button type="submit">Sync League</button>
        </form>
        
        <h3>Existing Leagues</h3>
        <div id="leaguesList">
          <p>Loading leagues...</p>
        </div>
      </div>
    </div>
    
    <!-- Managers Tab -->
    <div id="managers" class="tab-content">
      <div class="card">
        <h2>üë• Manage Managers</h2>
        
        <h3>Add Manager</h3>
        <form id="managerForm">
          <div class="form-group">
            <label for="managerLeagueId">League ID:</label>
            <input type="text" id="managerLeagueId" name="leagueId" required>
          </div>
          <div class="form-group">
            <label for="teamId">Team ID:</label>
            <input type="text" id="teamId" name="teamId" required>
          </div>
          <div class="form-group">
            <label for="managerEmail">Email:</label>
            <input type="email" id="managerEmail" name="email" required>
          </div>
          <div class="form-group">
            <label for="managerName">Manager Name (optional):</label>
            <input type="text" id="managerName" name="name" placeholder="John Doe">
          </div>
          <button type="submit">Add Manager</button>
        </form>
        
        <h3>Existing Managers</h3>
        <div id="managersList">
          <p>Loading managers...</p>
        </div>
      </div>
    </div>
    
    <!-- Configuration Tab -->
    <div id="config" class="tab-content">
      <div class="card">
        <h2>‚öôÔ∏è System Configuration</h2>
        <p>Configure OAuth credentials and API keys for Yahoo Fantasy, Google Gmail, and OpenAI.</p>
        
        <h3>üîë API Keys & Credentials</h3>
        <form id="configForm">
          <div class="form-group">
            <label for="yahooClientId">Yahoo Fantasy Client ID:</label>
            <input type="text" id="yahooClientId" name="yahooClientId" placeholder="Enter your Yahoo Fantasy API Client ID">
            <small>Get this from <a href="https://developer.yahoo.com/fantasysports/" target="_blank">Yahoo Developer Console</a></small>
          </div>
          
          <div class="form-group">
            <label for="yahooClientSecret">Yahoo Fantasy Client Secret:</label>
            <input type="password" id="yahooClientSecret" name="yahooClientSecret" placeholder="Enter your Yahoo Fantasy API Client Secret">
            <small>Keep this secret secure</small>
          </div>
          
          <div class="form-group">
            <label for="googleClientId">Google OAuth Client ID:</label>
            <input type="text" id="googleClientId" name="googleClientId" placeholder="Enter your Google OAuth Client ID">
            <small>Get this from <a href="https://console.developers.google.com/" target="_blank">Google Cloud Console</a></small>
          </div>
          
          <div class="form-group">
            <label for="googleClientSecret">Google OAuth Client Secret:</label>
            <input type="password" id="googleClientSecret" name="googleClientSecret" placeholder="Enter your Google OAuth Client Secret">
            <small>Keep this secret secure</small>
          </div>
          
          <div class="form-group">
            <label for="openaiApiKey">OpenAI API Key (Optional):</label>
            <input type="password" id="openaiApiKey" name="openaiApiKey" placeholder="Enter your OpenAI API Key">
            <small>Used for AI-powered guidance enhancement</small>
          </div>
          
          <button type="submit">Save Configuration</button>
        </form>
        
        <h3>üîó OAuth Setup Instructions</h3>
        <div class="card">
          <h4>Yahoo Fantasy Setup:</h4>
          <ol>
            <li>Go to <a href="https://developer.yahoo.com/fantasysports/" target="_blank">Yahoo Developer Console</a></li>
            <li>Create a new application</li>
            <li>Set redirect URI to: <code id="yahooRedirectUri">https://your-function-app.azurewebsites.net/api/auth/yahoo/callback</code></li>
            <li>Copy Client ID and Client Secret to the form above</li>
          </ol>
        </div>
        
        <div class="card">
          <h4>Google Gmail Setup:</h4>
          <ol>
            <li>Go to <a href="https://console.developers.google.com/" target="_blank">Google Cloud Console</a></li>
            <li>Create a new project or select existing</li>
            <li>Enable Gmail API</li>
            <li>Create OAuth 2.0 credentials</li>
            <li>Set redirect URI to: <code id="googleRedirectUri">https://your-function-app.azurewebsites.net/api/auth/google/callback</code></li>
            <li>Copy Client ID and Client Secret to the form above</li>
          </ol>
        </div>
        
        <h3>üß™ Test Configuration</h3>
        <div class="card">
          <h4>Test API Keys & OAuth</h4>
          <p>Verify that your configured credentials are working correctly.</p>
          
          <div class="form-group">
            <button onclick="testYahooAuth()" class="secondary">Test Yahoo OAuth</button>
            <span id="yahooTestStatus" class="status disconnected">Not Tested</span>
          </div>
          
          <div class="form-group">
            <button onclick="testGoogleAuth()" class="secondary">Test Google OAuth</button>
            <span id="googleTestStatus" class="status disconnected">Not Tested</span>
          </div>
          
          <div class="form-group">
            <button onclick="testOpenAI()" class="secondary">Test OpenAI API</button>
            <span id="openaiTestStatus" class="status disconnected">Not Tested</span>
          </div>
          
          <div class="form-group">
            <button onclick="testAllConfig()" class="primary">Test All Configuration</button>
          </div>
          
          <div id="testResults"></div>
        </div>
        
        <h3>üìä Current Configuration Status</h3>
        <div id="configStatus">
          <p>Loading configuration status...</p>
        </div>
      </div>
    </div>
    
    <!-- Generate Reports Tab -->
    <div id="reports" class="tab-content">
      <div class="card">
        <h2>üìÑ Generate Reports</h2>
        <p>Generate printable reports for all team managers. Perfect for Monday morning distribution!</p>
        
        <h3>üìã Report Generation</h3>
        <form id="reportForm">
          <div class="form-group">
            <label for="reportLeagueId">League ID:</label>
            <input type="text" id="reportLeagueId" name="leagueId" required placeholder="Enter league ID">
          </div>
          
          <div class="form-group">
            <label for="reportWeek">Week:</label>
            <input type="number" id="reportWeek" name="week" value="1" min="1" max="30" required>
          </div>
          
          <div class="form-group">
            <label for="reportTitle">Report Title (optional):</label>
            <input type="text" id="reportTitle" name="title" placeholder="e.g., Week 1 Fantasy Report">
          </div>
          
          <div class="form-group">
            <label for="reportFormat">Report Format:</label>
            <select id="reportFormat" name="format">
              <option value="pdf">PDF (Professional)</option>
              <option value="html">HTML (Web View)</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="reportOptions">Report Options:</label>
            <div style="margin: 10px 0;">
              <label><input type="checkbox" id="includeRosters" name="includeRosters" checked> Include Current Rosters</label><br>
              <label><input type="checkbox" id="includeSchedule" name="includeSchedule" checked> Include NHL Schedule</label><br>
              <label><input type="checkbox" id="includeStats" name="includeStats" checked> Include Player Statistics</label><br>
              <label><input type="checkbox" id="includeGuidance" name="includeGuidance" checked> Include AI Guidance</label>
            </div>
          </div>
          
          <button type="submit" class="primary">Generate Reports</button>
        </form>
        
        <h3>üè∑Ô∏è League Branding</h3>
        <div class="card">
          <h4>Upload League Logo</h4>
          <p>Upload a logo to appear at the top of each report page.</p>
          
          <form id="logoForm" enctype="multipart/form-data">
            <div class="form-group">
              <label for="logoFile">Logo File:</label>
              <input type="file" id="logoFile" name="logo" accept="image/*" required>
              <small>Recommended: PNG or JPG, max 2MB, 300x100px for best results</small>
            </div>
            <button type="submit" class="secondary">Upload Logo</button>
          </form>
          
          <div id="logoStatus">
            <p>No logo uploaded yet.</p>
          </div>
        </div>
        
        <div id="reportProgress" style="display: none;">
          <h3>üîÑ Generating Reports...</h3>
          <div class="progress-bar">
            <div id="progressFill" style="width: 0%; background: #007cba; height: 20px; border-radius: 4px;"></div>
          </div>
          <p id="progressText">Initializing...</p>
        </div>
        
        <div id="reportResults"></div>
        
        <h3>üìä Recent Reports</h3>
        <div id="recentReports">
          <p>No reports generated yet.</p>
        </div>
      </div>
    </div>
    
    <!-- Test Run Tab -->
    <div id="test" class="tab-content">
      <div class="card">
        <h2>üß™ Test Run</h2>
        <p>Test the complete guidance pipeline with email override.</p>
        
        <form id="runNowForm">
          <div class="form-group">
            <label for="testLeagueId">League ID:</label>
            <input type="text" id="testLeagueId" name="leagueId" required>
          </div>
          <div class="form-group">
            <label for="testTeamId">Team ID:</label>
            <input type="text" id="testTeamId" name="teamId" required>
          </div>
          <div class="form-group">
            <label for="testWeek">Week (optional):</label>
            <input type="number" id="testWeek" name="week" value="1" min="1" max="30">
          </div>
          <div class="form-group">
            <label for="testEmailOverride">Email Override (optional):</label>
            <input type="email" id="testEmailOverride" name="emailOverride" placeholder="test@example.com">
          </div>
          <button type="submit">Run Test</button>
        </form>
        
        <div id="testResult"></div>
      </div>
    </div>
    
    <!-- Logs Tab -->
    <div id="logs" class="tab-content">
      <div class="card">
        <h2>üìã System Logs</h2>
        <div id="logsContent">
          <p>Recent guidance runs and system activity will appear here.</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Tab switching
    function showTab(tabName) {
      // Hide all tabs
      document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      
      // Show selected tab
      document.getElementById(tabName).classList.add('active');
      event.target.classList.add('active');
      
      // Load data for the tab
      if (tabName === 'leagues') loadLeagues();
      if (tabName === 'managers') loadManagers();
      if (tabName === 'config') loadConfig();
      if (tabName === 'reports') loadReports();
      if (tabName === 'logs') loadLogs();
    }
    
    // Authentication
    function authYahoo() {
      window.open('/api/auth/yahoo/login', '_blank');
    }
    
    function authGoogle() {
      window.open('/api/auth/google/login', '_blank');
    }
    
    // League management
    document.getElementById('leagueForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const formData = new FormData(e.target);
      const data = Object.fromEntries(formData.entries());
      
      try {
        const response = await fetch('/api/admin/league', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        
        const result = await response.json();
        showResult(result, response.ok);
        if (response.ok) loadLeagues();
      } catch (error) {
        showResult({ message: error.message }, false);
      }
    });
    
    document.getElementById('syncForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const formData = new FormData(e.target);
      const leagueId = formData.get('leagueId');
      
      try {
        const response = await fetch(`/api/league/${leagueId}/sync`, {
          method: 'POST'
        });
        
        const result = await response.json();
        showResult(result, response.ok);
        if (response.ok) loadLeagues();
      } catch (error) {
        showResult({ message: error.message }, false);
      }
    });
    
    // Manager management
    document.getElementById('managerForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const formData = new FormData(e.target);
      const data = Object.fromEntries(formData.entries());
      
      try {
        const response = await fetch('/api/admin/manager', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        
        const result = await response.json();
        showResult(result, response.ok);
        if (response.ok) loadManagers();
      } catch (error) {
        showResult({ message: error.message }, false);
      }
    });
    
    // Logo upload
    document.getElementById('logoForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const formData = new FormData(e.target);
      
      try {
        const response = await fetch('/api/admin/upload-logo', {
          method: 'POST',
          body: formData
        });
        
        const result = await response.json();
        
        if (response.ok) {
          document.getElementById('logoStatus').innerHTML = `
            <div class="result success">
              <p>‚úÖ Logo uploaded successfully!</p>
              <img src="${result.logoUrl}" style="max-width: 200px; max-height: 100px; border: 1px solid #ddd; padding: 5px;">
            </div>
          `;
        } else {
          document.getElementById('logoStatus').innerHTML = `
            <div class="result error">
              <p>‚ùå Logo upload failed: ${result.message}</p>
            </div>
          `;
        }
      } catch (error) {
        document.getElementById('logoStatus').innerHTML = `
          <div class="result error">
            <p>‚ùå Error: ${error.message}</p>
          </div>
        `;
      }
    });
    
    // Report generation
    document.getElementById('reportForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const formData = new FormData(e.target);
      const data = Object.fromEntries(formData.entries());
      
      // Show progress
      document.getElementById('reportProgress').style.display = 'block';
      document.getElementById('reportResults').innerHTML = '';
      
      try {
        const response = await fetch('/api/admin/generate-reports', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        
        const result = await response.json();
        
        if (response.ok) {
          // Show success with download links
          const format = data.format || 'html';
          const downloadText = format === 'pdf' ? 'üìÑ Download PDF Report' : 'üìÑ Download HTML Report';
          const printText = format === 'pdf' ? 'üñ®Ô∏è Print PDF' : 'üñ®Ô∏è Print View';
          
          document.getElementById('reportResults').innerHTML = `
            <div class="result success">
              <h3>‚úÖ Reports Generated Successfully!</h3>
              <p><strong>Total Teams:</strong> ${result.totalTeams}</p>
              <p><strong>Generated:</strong> ${result.generatedReports}</p>
              <p><strong>Failed:</strong> ${result.failedReports}</p>
              <p><strong>Format:</strong> ${format.toUpperCase()}</p>
              <div style="margin-top: 15px;">
                <a href="${result.downloadUrl}" class="button primary" target="_blank">${downloadText}</a>
                <a href="${result.printUrl}" class="button secondary" target="_blank">${printText}</a>
              </div>
            </div>
          `;
        } else {
          document.getElementById('reportResults').innerHTML = `
            <div class="result error">
              <h3>‚ùå Report Generation Failed</h3>
              <p>${result.message || 'Unknown error occurred'}</p>
            </div>
          `;
        }
      } catch (error) {
        document.getElementById('reportResults').innerHTML = `
          <div class="result error">
            <h3>‚ùå Error</h3>
            <p>${error.message}</p>
          </div>
        `;
      } finally {
        document.getElementById('reportProgress').style.display = 'none';
        loadReports(); // Refresh recent reports
      }
    });
    
    // Configuration management
    document.getElementById('configForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const formData = new FormData(e.target);
      const data = Object.fromEntries(formData.entries());
      
      try {
        const response = await fetch('/api/admin/config', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        
        const result = await response.json();
        showResult(result, response.ok);
        if (response.ok) loadConfig();
      } catch (error) {
        showResult({ message: error.message }, false);
      }
    });
    
    // Test run
    document.getElementById('runNowForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const formData = new FormData(e.target);
      const data = Object.fromEntries(formData.entries());
      
      const resultDiv = document.getElementById('testResult');
      resultDiv.innerHTML = '<div class="result info">Running test...</div>';
      
      try {
        const response = await fetch('/api/admin/run-now', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        
        const result = await response.json();
        
        if (response.ok) {
          resultDiv.innerHTML = `<div class="result success">
            <h3>‚úÖ Test Successful!</h3>
            <p><strong>Message ID:</strong> ${result.messageId}</p>
            <p><strong>Email:</strong> ${result.email}</p>
            <p><strong>Preview:</strong></p>
            <ul>${result.preview.map(bullet => `<li>${bullet}</li>`).join('')}</ul>
          </div>`;
        } else {
          resultDiv.innerHTML = `<div class="result error">
            <h3>‚ùå Test Failed</h3>
            <p>${result.message || 'Unknown error'}</p>
          </div>`;
        }
      } catch (error) {
        resultDiv.innerHTML = `<div class="result error">
          <h3>‚ùå Error</h3>
          <p>${error.message}</p>
        </div>`;
      }
    });
    
    // Load data functions
    async function loadLeagues() {
      try {
        const response = await fetch('/api/admin/league');
        const leagues = await response.json();
        
        const listDiv = document.getElementById('leaguesList');
        if (leagues.length === 0) {
          listDiv.innerHTML = '<p>No leagues configured yet.</p>';
        } else {
          listDiv.innerHTML = leagues.map(league => `
            <div class="card">
              <h4>${league.name || `League ${league.leagueId}`}</h4>
              <p><strong>ID:</strong> ${league.leagueId}</p>
              <p><strong>Sport:</strong> ${league.sport}</p>
              <p><strong>Provider:</strong> ${league.provider}</p>
              <p><strong>Current Week:</strong> ${league.currentWeek || 'Unknown'}</p>
              <p><strong>Scoring Type:</strong> ${league.settings?.type || 'Unknown'}</p>
            </div>
          `).join('');
        }
      } catch (error) {
        document.getElementById('leaguesList').innerHTML = `<p>Error loading leagues: ${error.message}</p>`;
      }
    }
    
    async function loadManagers() {
      try {
        const response = await fetch('/api/admin/manager');
        const managers = await response.json();
        
        const listDiv = document.getElementById('managersList');
        if (managers.length === 0) {
          listDiv.innerHTML = '<p>No managers configured yet.</p>';
        } else {
          listDiv.innerHTML = managers.map(manager => `
            <div class="card">
              <h4>${manager.name || `Manager ${manager.teamId}`}</h4>
              <p><strong>Team ID:</strong> ${manager.teamId}</p>
              <p><strong>Email:</strong> ${manager.email}</p>
              <p><strong>League:</strong> ${manager.leagueId}</p>
            </div>
          `).join('');
        }
      } catch (error) {
        document.getElementById('managersList').innerHTML = `<p>Error loading managers: ${error.message}</p>`;
      }
    }
    
    async function loadConfig() {
      try {
        const response = await fetch('/api/admin/config');
        const config = await response.json();
        
        // Populate form fields
        document.getElementById('yahooClientId').value = config.yahooClientId || '';
        document.getElementById('yahooClientSecret').value = config.yahooClientSecret ? '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢' : '';
        document.getElementById('googleClientId').value = config.googleClientId || '';
        document.getElementById('googleClientSecret').value = config.googleClientSecret ? '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢' : '';
        document.getElementById('openaiApiKey').value = config.openaiApiKey ? '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢' : '';
        
        // Update redirect URIs
        document.getElementById('yahooRedirectUri').textContent = config.yahooRedirectUri || 'https://your-function-app.azurewebsites.net/api/auth/yahoo/callback';
        document.getElementById('googleRedirectUri').textContent = config.googleRedirectUri || 'https://your-function-app.azurewebsites.net/api/auth/google/callback';
        
        // Show configuration status
        const statusDiv = document.getElementById('configStatus');
        statusDiv.innerHTML = `
          <div class="card">
            <h4>Configuration Status:</h4>
            <p>Yahoo Client ID: <span class="status ${config.yahooClientId ? 'connected' : 'disconnected'}">${config.yahooClientId ? 'Configured' : 'Not Set'}</span></p>
            <p>Google Client ID: <span class="status ${config.googleClientId ? 'connected' : 'disconnected'}">${config.googleClientId ? 'Configured' : 'Not Set'}</span></p>
            <p>OpenAI API Key: <span class="status ${config.openaiApiKey ? 'connected' : 'disconnected'}">${config.openaiApiKey ? 'Configured' : 'Not Set'}</span></p>
          </div>
        `;
      } catch (error) {
        document.getElementById('configStatus').innerHTML = `<p>Error loading configuration: ${error.message}</p>`;
      }
    }
    
    // Configuration testing functions
    async function testYahooAuth() {
      const statusSpan = document.getElementById('yahooTestStatus');
      statusSpan.textContent = 'Testing...';
      statusSpan.className = 'status disconnected';
      
      try {
        const response = await fetch('/api/admin/test/yahoo', { method: 'POST' });
        const result = await response.json();
        
        if (response.ok) {
          statusSpan.textContent = '‚úÖ Working';
          statusSpan.className = 'status connected';
        } else {
          statusSpan.textContent = '‚ùå Failed';
          statusSpan.className = 'status disconnected';
        }
        
        showTestResult('Yahoo OAuth', result);
      } catch (error) {
        statusSpan.textContent = '‚ùå Error';
        statusSpan.className = 'status disconnected';
        showTestResult('Yahoo OAuth', { error: error.message });
      }
    }
    
    async function testGoogleAuth() {
      const statusSpan = document.getElementById('googleTestStatus');
      statusSpan.textContent = 'Testing...';
      statusSpan.className = 'status disconnected';
      
      try {
        const response = await fetch('/api/admin/test/google', { method: 'POST' });
        const result = await response.json();
        
        if (response.ok) {
          statusSpan.textContent = '‚úÖ Working';
          statusSpan.className = 'status connected';
        } else {
          statusSpan.textContent = '‚ùå Failed';
          statusSpan.className = 'status disconnected';
        }
        
        showTestResult('Google OAuth', result);
      } catch (error) {
        statusSpan.textContent = '‚ùå Error';
        statusSpan.className = 'status disconnected';
        showTestResult('Google OAuth', { error: error.message });
      }
    }
    
    async function testOpenAI() {
      const statusSpan = document.getElementById('openaiTestStatus');
      statusSpan.textContent = 'Testing...';
      statusSpan.className = 'status disconnected';
      
      try {
        const response = await fetch('/api/admin/test/openai', { method: 'POST' });
        const result = await response.json();
        
        if (response.ok) {
          statusSpan.textContent = '‚úÖ Working';
          statusSpan.className = 'status connected';
        } else {
          statusSpan.textContent = '‚ùå Failed';
          statusSpan.className = 'status disconnected';
        }
        
        showTestResult('OpenAI API', result);
      } catch (error) {
        statusSpan.textContent = '‚ùå Error';
        statusSpan.className = 'status disconnected';
        showTestResult('OpenAI API', { error: error.message });
      }
    }
    
    async function testAllConfig() {
      // Reset all status indicators
      document.getElementById('yahooTestStatus').textContent = 'Testing...';
      document.getElementById('googleTestStatus').textContent = 'Testing...';
      document.getElementById('openaiTestStatus').textContent = 'Testing...';
      
      // Run all tests
      await testYahooAuth();
      await testGoogleAuth();
      await testOpenAI();
      
      // Show summary
      const resultsDiv = document.getElementById('testResults');
      resultsDiv.innerHTML = '<div class="result info"><h4>Configuration Test Complete</h4><p>Check the status indicators above for individual test results.</p></div>';
    }
    
    function showTestResult(testName, result) {
      const resultsDiv = document.getElementById('testResults');
      const className = result.error ? 'error' : 'success';
      const message = result.error ? result.error : result.message || 'Test completed successfully';
      
      resultsDiv.innerHTML = `<div class="result ${className}"><strong>${testName}:</strong> ${message}</div>`;
    }
    
    async function loadReports() {
      try {
        const response = await fetch('/api/admin/reports');
        const reports = await response.json();
        
        const reportsDiv = document.getElementById('recentReports');
        if (reports.length === 0) {
          reportsDiv.innerHTML = '<p>No reports generated yet.</p>';
        } else {
          reportsDiv.innerHTML = reports.map(report => `
            <div class="card">
              <h4>${report.title || `Report ${report.id}`}</h4>
              <p><strong>League:</strong> ${report.leagueId}</p>
              <p><strong>Week:</strong> ${report.week}</p>
              <p><strong>Generated:</strong> ${new Date(report.createdAt).toLocaleString()}</p>
              <p><strong>Teams:</strong> ${report.totalTeams}</p>
              <div style="margin-top: 10px;">
                <a href="${report.downloadUrl}" class="button secondary" target="_blank">üìÑ Download</a>
                <a href="${report.printUrl}" class="button secondary" target="_blank">üñ®Ô∏è Print</a>
              </div>
            </div>
          `).join('');
        }
      } catch (error) {
        document.getElementById('recentReports').innerHTML = `<p>Error loading reports: ${error.message}</p>`;
      }
    }
    
    async function loadLogs() {
      document.getElementById('logsContent').innerHTML = '<p>Logs feature coming soon...</p>';
    }
    
    // Utility functions
    function showResult(result, success) {
      const message = success ? result.message || 'Success!' : result.message || 'Error occurred';
      const className = success ? 'success' : 'error';
      
      // Create a temporary result div if none exists
      let resultDiv = document.querySelector('.result');
      if (!resultDiv) {
        resultDiv = document.createElement('div');
        resultDiv.className = 'result';
        document.querySelector('.card').appendChild(resultDiv);
      }
      
      resultDiv.className = `result ${className}`;
      resultDiv.innerHTML = `<p>${message}</p>`;
      
      // Auto-hide after 5 seconds
      setTimeout(() => {
        if (resultDiv) resultDiv.style.display = 'none';
      }, 5000);
    }
    
    // Load initial data
    loadLeagues();
  </script>
</body></html>
